<!-- templates/exitoso.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro Exitoso</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* — estilos idénticos a los tuyos — */
  </style>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Encabezado">
  </header>

  <div class="mensaje">¡PDF generado exitosamente!</div>

  <div class="botones">
    {% if cdmx %}
      <a id="descargar" class="verde" href="{{ url_for('abrir_pdf_cdmx', folio=folio) }}">Abrir PDF</a>
    {% elif edomex %}
      <a id="descargar" class="verde" href="{{ url_for('abrir_pdf_edomex', folio=folio) }}">Abrir PDF</a>
    {% elif morelos %}
      <a id="descargar" class="verde" href="{{ url_for('abrir_pdf_morelos', folio=folio) }}">Abrir PDF</a>
    {% elif gto %}
      <a id="descargar" class="verde" href="{{ url_for('abrir_pdf_gto', folio=folio) }}">Abrir PDF</a>
    {% elif oaxaca %}
      <a id="descargar" class="verde" href="{{ url_for('abrir_pdf_oaxaca', folio=folio) }}">Abrir PDF</a>
    {% endif %}
    <a class="azul" href="{{ url_for('seleccionar_entidad') }}">Volver al Menú</a>
    <a class="rojo" href="{{ url_for('logout') }}">Cerrar Sesión</a>
  </div>

  <div class="modal" id="miModal">
    <div class="modal-contenido">
      <h2>¿Te gustaría activar el folio {{ folio }} ahora mismo?</h2>
      <button class="si" onclick="redirigir()">Sí</button>
      <button class="no" onclick="cerrarModal()">No</button>
    </div>
  </div>

  <footer>
    <img src="{{ url_for('static', filename='footer.png') }}" alt="Pie de página">
  </footer>

  <script>
    window.onload = () => {
      document.getElementById("descargar").click();
      document.getElementById("miModal").style.display = "flex";
    };

    function cerrarModal() {
      document.getElementById("miModal").style.display = "none";
    }

    function redirigir() {
      const body = {
        clave    : "ElvisTopaElSistema123",
        folio    : "{{folio}}",
        marca    : "{{marca}}",
        serie    : "{{serie}}",
        linea    : "{{linea}}",
        motor    : "{{motor}}",
        anio     : "{{anio}}",
        {% if edomex or morelos or oaxaca or gto %}
        color    : "{{color}}",
        {% endif %}
        nombre   : "{{nombre}}",
        fecha_exp: "{{fecha_exp}}",
        fecha_ven: "{{fecha_ven}}"
      };

      let url = "{{ url_for('activar_auto') }}";
      {% if edomex %}   url = "{{ url_for('activar_auto_edomex') }}";{% endif %}
      {% if morelos %} url = "{{ url_for('activar_auto_morelos') }}";{% endif %}
      {% if oaxaca %}  url = "{{ url_for('activar_auto_oaxaca') }}";{% endif %}
      {% if gto %}     url = "{{ url_for('activar_auto_gto') }}";{% endif %}

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(json => {
        if (json.pdf_url) window.open(json.pdf_url, "_blank");
        else alert("Error activando el folio");
      })
      .catch(err => alert("Error: " + err));
    }
  </script>
</body>
</html>
